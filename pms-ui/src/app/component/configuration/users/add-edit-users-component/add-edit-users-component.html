<h2 mat-dialog-title>Add User</h2>
<mat-dialog-content class="dialog-body">
<form [formGroup]="userForm" class="user-form">
    <div class="mat-typography m-2 p-2">
        <div class="row">
            <div class="col-4 mt-2">
                <div class="form-floating">
                    <input type="text" class="form-control shadow-sm rounded-3" id="firstName" placeholder="First Name"
                        formControlName="firstName" required>
                    <label class="fw-bold" for="firstName">First Name*</label>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                    <input type="text" class="form-control shadow-sm rounded-3" id="lastName" placeholder="Last Name"
                        formControlName="lastName" required>
                    <label class="fw-bold" for="lastName">Last Name*</label>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                    <input type="email" class="form-control shadow-sm rounded-3" id="emailId" placeholder="Email ID"
                        formControlName="emailId" required>
                    <label class="fw-bold" for="emailId">Email ID*</label>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                    <input type="text" class="form-control shadow-sm rounded-3" id="mobileNumber"
                        placeholder="Phone Number" formControlName="mobileNumber" required>
                    <label class="fw-bold" for="mobileNumber">Mobile Number*</label>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                    <input type="text" class="form-control shadow-sm rounded-3" id="emergencyContactNumber"
                        placeholder="Emergency Contact Number" formControlName="emergencyContactNumber" required>
                    <label class="fw-bold" for="emergencyContactNumber">Emergency Contact Number*</label>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                <label class="form-label fw-bold">Select Gender*</label>
                <select class="form-select" [(ngModel)]="gender">
                    <option value="" disabled selected>-- Select --</option>
                    @for (g of genders; track $index) {
                    <option [value]="g">{{ g }}</option>
                    }
                </select>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                <label class="form-label fw-bold">Select Status*</label>
                <select class="form-select" [(ngModel)]="status">
                    <option value="" disabled selected>-- Select --</option>
                    @for (status of userStatus; track $index) {
                    <option [value]="status">{{ status }}</option>
                    }
                </select>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                <label class="form-label fw-bold">Select UserType*</label>
                <select class="form-select" [(ngModel)]="userType">
                    <option value="" disabled selected>-- Select --</option>
                    @for (type of userTypes; track $index) {
                    <option [value]="type">{{ type }}</option>
                    }
                </select>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                    <input type="date" class="form-control shadow-sm rounded-3" id="dob" placeholder="Date of Birth"
                        formControlName="dob" >
                    <label class="fw-bold" for="dob">Date of Birth (Optional)</label>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                <label class="form-label fw-bold">Select Department*</label>
                <select class="form-select" [(ngModel)]="departmentName">
                    <option value="" disabled selected>-- Select --</option>
                    @for (type of departments; track $index) {
                    <option [value]="type">{{ type }}</option>
                    }
                </select>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                <div class="position-relative">
                    <label class="fw-bold">Specialization*</label>
                    <input type="text" class="form-control shadow-sm rounded-3" [(ngModel)]="searchText"
                        [ngModelOptions]="{standalone: true}" (input)="filterSpecializations()" (focus)="showDropdown = true">
                
                    <!-- Autocomplete dropdown -->
                    @if (showDropdown && filteredList.length > 0) {
                    <ul class="list-group position-absolute w-100 shadow-sm"
                        style="z-index: 1000;">
                        @for (item of filteredList; track $index) {
                        <li class="list-group-item list-group-item-action"
                            (click)="selectSpecialization(item)">
                            {{ item }}
                        </li>
                        }
                    </ul>
                    } 
                </div>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                    <input type="text" class="form-control shadow-sm rounded-3" id="licenseNumber"
                        placeholder="License Number" formControlName="licenseNumber">
                    <label class="fw-bold" for="licenseNumber">License Number*</label>
                </div>
            </div>
            <div class="col-4 mt-2">
                <div class="form-floating">
                <label class="form-label fw-bold">Select Shift*</label>
                <select class="form-select" [(ngModel)]="shiftSchedule">
                    <option value="" disabled selected>-- Select --</option>
                    @for (shift of shiftList; track $index) {
                    <option [value]="shift.value">{{ shift.label }}</option>
                    }
                </select>
                </div>
            </div>

            <!-- PROFILE IMAGE -->
            <div class="col-4 mt-2">
                <label class=" fw-bold">Profile Image (Max 1MB)</label>
                <input type="file" class="form-control" accept="image/*"
                       (change)="onFileSelect($event)">
                 @if (imageError) {
                <small class="text-danger" >{{ imageError }}</small>
                 }
            </div>
        
        <!-- ---------------- ADDRESS SECTION ---------------- -->
        <h4 class="mt-4 mb-3 fw-bold">Address Details</h4>

        <div formArrayName="addresses">

            <div class="border rounded-3 p-3 mb-3 shadow-sm"
                 *ngFor="let addr of addresses.controls; let i = index" 
                 [formGroupName]="i">

                <div class="row">
                    <div class="col-4 mt-2">
                        <div class="form-floating">
                            <input type="text" class="form-control shadow-sm rounded-3"
                                   placeholder="Address Line 1"
                                   formControlName="addressLine1">
                            <label class="fw-bold" >Address Line 1 (Optional)</label>
                        </div>
                    </div>

                    <div class="col-4 mt-2">
                        <div class="form-floating">
                            <input type="text" class="form-control shadow-sm rounded-3"
                                   placeholder="Address Line 2"
                                   formControlName="addressLine2" required>
                            <label class="fw-bold">Address Line 2*</label>
                        </div>
                    </div>

                    <div class="col-4 mt-2">
                        <div class="form-floating">
                            <input type="text" class="form-control shadow-sm rounded-3"
                                   placeholder="Street"
                                   formControlName="street" required>
                            <label class="fw-bold">Street*</label>
                        </div>
                    </div>

                    <div class="col-4 mt-2">
                        <div class="form-floating">
                            <input type="text" class="form-control shadow-sm rounded-3"
                                   placeholder="City"
                                   formControlName="city" required>
                            <label class="fw-bold">City*</label>
                        </div>
                    </div>

                    <div class="col-4 mt-2">
                        <div class="form-floating">
                            <input type="text" class="form-control shadow-sm rounded-3"
                                   placeholder="State"
                                   formControlName="state" required>
                            <label class="fw-bold">State*</label>
                        </div>
                    </div>

                    <div class="col-4 mt-2">
                        <div class="form-floating">
                            <input type="text" class="form-control shadow-sm rounded-3"
                                   placeholder="Country"
                                   formControlName="country" required>
                            <label class="fw-bold">Country*</label>
                        </div>
                    </div>

                    <div class="col-4 mt-2">
                        <div class="form-floating">
                            <input type="text" class="form-control shadow-sm rounded-3"
                                   placeholder="Postal Code"
                                   formControlName="postalCode" required>
                            <label class="fw-bold">Postal Code*</label>
                        </div>
                    </div>

                </div>

                <!-- Add / Remove buttons -->
                <div class="d-flex justify-content-end mt-3">
                    <button type="button" class="btn btn-danger btn-sm"
                            (click)="removeAddress(i)"
                            [disabled]="addresses.length === 1">
                        Remove
                    </button>
                </div>

            </div>

            <button type="button" class="btn btn-success btn-sm mb-3"
                    (click)="addAddress()">
                + Add Another Address
            </button>

        </div>
        <!-- ---------------- END ADDRESS SECTION ---------------- -->
        </div>
    </div>
</form>
</mat-dialog-content>

<mat-dialog-actions align="end" class="dialog-footer">
    <button class="btn btn-secondary me-2" mat-dialog-close>Cancel</button>
    <button class="btn btn-primary" [disabled]="userForm.invalid">Submit</button>
</mat-dialog-actions>